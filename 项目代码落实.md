# 项目代码落实方案

## 一、项目概述与目标重申

### 1.1 项目名称
**TikTok & 社媒AI智能获客 + 自动化触达 + 智能询盘转化 Agent 系统**

### 1.2 项目目标
本项目的核心目标是构建一个基于 **AI Agent、可插拔 Skill 插件和可视化工作流引擎** 的全链路自动化系统，旨在为外贸B端客户（品牌方、达人、MCN、渠道商）提供从社媒获客到询盘转化的端到端解决方案。通过自动化替代80%以上的人工重复性工作，实现7×24小时不间断运行，显著提升获客效率和转化率。

## 二、核心技术架构与选型

### 2.1 整体架构设计
系统将采用微服务架构，各核心模块独立部署，通过API进行通信，确保高可用、可伸缩和易于维护。

```
+---------------------+       +---------------------+       +---------------------+
|     AI Agent Core   |       |   Workflow Engine   |       |   Admin Dashboard   |
| (Task Orchestration)| <---> | (Visual Editor, Rules)| <---> | (Monitoring, Control)|
+---------------------+       +---------------------+       +---------------------+
        ^   |                           ^
        |   v                           |
+---------------------+       +---------------------+
|   Skill Modules     | <---> | Third-Party Integrations |
| (Plug-in System)    |       | (Social Media APIs, Email, WhatsApp, CRM) |
+---------------------+       +---------------------+
```

### 2.2 AI Agent 主框架
-   **技术栈选型**: Python (FastAPI/Django) + LangChain/LlamaIndex (Agentic Framework)
-   **核心功能**:
    *   **多任务/多步骤自动化执行**: 基于Agent的规划、执行、反思循环，结合任务队列（如Celery + Redis/RabbitMQ）实现异步、并发任务处理。
    *   **Skill 插件化**: 设计清晰的Skill接口规范（API/SDK），允许Skill模块独立开发、打包、部署和注册。采用动态加载机制。
    *   **工作流可视化编排**: 与工作流引擎深度集成，Agent根据工作流定义调用相应Skill。

### 2.3 Skill 技能包模块
-   **技术栈选型**: Python (独立服务/函数)，可使用Docker容器化部署。
-   **核心功能**:
    *   **独立功能封装**: 每个Skill作为一个独立的微服务或函数，通过统一的API接口暴露功能。
    *   **可拖拽组合**: 提供元数据描述（输入、输出、参数），供工作流引擎进行可视化编排。
    *   **版本管理**: 支持Skill的版本迭代和兼容性管理。

### 2.4 工作流引擎
-   **技术栈选型**: Go/Python (Cadence/Temporal, Apache Airflow, Prefect) 或自研轻量级引擎。考虑到可视化编排，可集成前端可视化库（如React Flow）。
-   **核心功能**:
    *   **可视化编排**: 前端提供拖拽式界面，后端将图形化配置转换为可执行的工作流定义（如JSON/YAML）。
    *   **条件判断/循环**: 支持基于数据结果的条件分支和迭代逻辑。
    *   **定时任务**: 集成Cron表达式或调度器，支持周期性任务。
    *   **异常处理**: 统一的错误捕获机制，支持自定义重试策略、告警通知。
    *   **中断与接管**: 提供API接口，允许外部系统（如老板端）中断正在执行的工作流，并进行人工干预。

### 2.5 后台管理系统（老板端）
-   **技术栈选型**: 前端 (React/Vue + Ant Design/Element UI)，后端 (Node.js/Python FastAPI)。
-   **核心功能**:
    *   **实时监控**: 展示Agent任务状态、工作流执行进度、Skill调用日志。
    *   **对话查看**: 实时查看Agent与客户的对话记录，支持关键词搜索。
    *   **一键接管**: 在对话界面提供按钮，允许老板随时介入与客户的沟通。
    *   **数据统计**: 获客数量、转化率、Skill调用频率、Agent效率等报表。
    *   **Skill/工作流管理**: Skill的安装、卸载、配置；工作流的创建、编辑、发布、版本管理。

### 2.6 第三方接口集成
-   **技术栈选型**: Python (requests库)，Node.js (axios库)。
-   **核心功能**:
    *   **社媒平台**:
        *   **TikTok**: 考虑使用TikTok Open Platform API (如果可用且符合需求) 或通过模拟浏览器行为（如Selenium/Playwright）进行数据抓取。反爬策略至关重要。
        *   **Instagram/Facebook/YouTube**: 优先使用官方API，若无则考虑模拟浏览器。
    *   **邮箱**: 集成SMTP/IMAP协议，或使用第三方邮件服务API（如SendGrid, Mailgun）。
    *   **WhatsApp**: 使用WhatsApp Business API或第三方WhatsApp集成服务。
    *   **Excel/在线表格**:
        *   **本地Excel**: 使用`openpyxl`/`pandas`库进行读写。
        *   **Google Sheets**: 使用Google Sheets API。
        *   **飞书/钉钉**: 使用其开放平台API。
    *   **CRM**: 提供通用API接口，支持与主流CRM系统（如Salesforce, HubSpot）集成，或通过Webhook方式。

## 三、Skill 技能包详细需求与技术实现

### Skill 1：社媒B端客户智能挖掘与抓取

#### 目标
从 TikTok、Instagram、YouTube、Facebook 等平台自动抓取 B 端客户公开信息。

#### 技术实现要点
1.  **平台适配器**: 为每个社媒平台开发独立的抓取适配器，封装平台特有的抓取逻辑和反爬策略。
2.  **抓取策略**:
    *   **关键词/类目/话题定向挖掘**: 通过平台搜索接口（若有）或模拟用户搜索行为，结合关键词列表进行目标用户发现。
    *   **用户主页解析**: 抓取用户主页上的公开信息（用户名、链接、粉丝数、联系方式等）。
    *   **翻页自动抓取**: 实现分页逻辑，确保完整抓取。
3.  **反爬策略**:
    *   **IP池**: 集成第三方代理IP服务，实现IP轮换。
    *   **请求间隔**: 动态调整请求频率，模拟人类行为。
    *   **账号池**: 使用多个社媒账号进行轮换抓取，降低封禁风险。
    *   **User-Agent轮换**: 模拟不同浏览器和设备。
    *   **验证码识别**: 集成验证码识别服务（如2Captcha, Anti-Captcha）。
    *   **无头浏览器**: 使用Selenium/Playwright进行模拟操作，规避JS渲染障碍。
4.  **数据存储**: 原始抓取数据先存入NoSQL数据库（如MongoDB），便于灵活存储非结构化数据。
5.  **任务管理**: 支持批量任务提交、定时任务调度、任务状态监控。
6.  **去重与过滤**: 在抓取过程中或抓取后进行数据去重，并根据预设规则过滤无效信息（如粉丝数过低、非B端用户）。

#### 抓取字段与技术映射
-   **用户名**: 页面解析
-   **主页链接**: 页面解析
-   **类目/行业**: 结合AI文本分类（NLP）对用户简介、内容进行分析，或从平台标签获取。
-   **粉丝数**: 页面解析
-   **主页公开邮箱/WhatsApp/电话/Instagram/Website**: 正则表达式匹配、NLP实体识别、特定HTML元素解析。
-   **国家/地区**: IP地址归属地判断、用户简介信息提取。
-   **语言**: 用户内容语言检测。
-   **活跃时间**: 通过发布内容频率、最新发布时间等指标估算。

### Skill 2：客户数据自动清洗与Excel结构化输出

#### 目标
将杂乱的抓取数据进行标准化处理，并输出为结构化的客户表格。

#### 技术实现要点
1.  **数据清洗模块**:
    *   **去重**: 基于关键字段（如主页链接、邮箱、WhatsApp）进行精确和模糊去重。
    *   **补全**: 利用AI（如LLM）或规则引擎，根据已有信息推断并补全缺失字段。
    *   **格式统一**: 电话号码国际化、邮箱格式校验、网址标准化。
    *   **空值处理**: 根据业务规则填充默认值或标记。
2.  **数据打标签模块**:
    *   **客户类型**: 基于用户简介、内容、粉丝数等特征，利用机器学习分类模型（如BERT/TextCNN）进行分类（达人/MCN/品牌/批发商）。
    *   **意向等级**: 结合用户活跃度、内容相关性、联系方式完整度等指标，通过规则引擎或简单ML模型进行评估。
    *   **国家/类目**: 沿用Skill 1的识别结果，并进行二次校验和标准化。
    *   **是否带联系方式**: 简单布尔判断。
3.  **输出模块**:
    *   **本地Excel**: 使用`pandas`库处理数据框，并导出为`.xlsx`文件。
    *   **在线表格**:
        *   **Google Sheets**: 使用`gspread`库或Google Sheets API进行认证和数据写入。
        *   **飞书/钉钉**: 调用其开放平台API，将数据写入指定表格。
4.  **固定模板**: 定义一套标准的输出字段映射规则，确保所有输出符合预设模板。

## 四、开发阶段与里程碑

### 阶段一：核心Agent与基础Skill MVP (2个月)
-   **目标**: 搭建AI Agent主框架、工作流引擎原型、后台管理系统基础功能，并实现第一个核心Skill（TikTok客户抓取）。
-   **里程碑**:
    *   AI Agent核心调度与Skill接口定义完成。
    *   工作流引擎实现基本串行、并行、条件分支。
    *   后台管理系统用户登录、任务列表、日志查看。
    *   TikTok客户抓取Skill (MVP) 完成，能抓取基本字段并输出本地Excel。

### 阶段二：功能完善与多平台扩展 (3个月)
-   **目标**: 完善工作流引擎功能，扩展更多社媒平台抓取，实现数据清洗Skill，并开始自动化触达Skill的开发。
-   **里程碑**:
    *   工作流引擎支持循环、定时、异常重试。
    *   Instagram/YouTube/Facebook抓取Skill完成。
    *   客户数据清洗Skill完成，支持在线表格输出。
    *   自动化触达Skill (邮件/WhatsApp) MVP完成。

### 阶段三：智能询盘与老板端高级功能 (3个月)
-   **目标**: 实现智能询盘转化Agent，完善老板端监控与接管功能，集成CRM。
-   **里程碑**:
    *   智能询盘转化Agent (LLM集成) 完成。
    *   老板端实时对话查看、一键接管、数据统计报表。
    *   CRM集成接口完成。
    *   系统稳定性测试与性能优化。

### 阶段四：部署、测试与上线 (1个月)
-   **目标**: 完成系统部署、全面测试、用户培训并正式上线。
-   **里程碑**:
    *   生产环境部署完成。
    *   全链路集成测试、压力测试。
    *   用户手册与培训。
    *   系统正式上线。

## 五、团队角色与职责

-   **项目经理**: 负责项目规划、进度管理、风险控制、内外部沟通。
-   **后端开发工程师 (AI Agent/Skill/Workflow)**: 负责AI Agent核心逻辑、Skill模块开发、工作流引擎后端实现、第三方接口集成。
-   **前端开发工程师 (Admin Dashboard/Workflow Editor)**: 负责后台管理系统、可视化工作流编辑器的UI/UX开发。
-   **数据工程师**: 负责数据存储、清洗、标签化、报表生成。
-   **测试工程师**: 负责功能测试、集成测试、性能测试、安全测试。
-   **DevOps工程师**: 负责CI/CD、容器化部署、监控告警、生产环境维护。

## 六、部署与运维

-   **部署环境**: 优先考虑云服务 (AWS/Azure/GCP)，采用Kubernetes进行容器编排，实现弹性伸缩和高可用。
-   **CI/CD**: 建立自动化CI/CD流水线，确保代码质量和快速部署。
-   **监控告警**: 集成Prometheus/Grafana进行系统性能监控，ELK Stack进行日志管理，配置告警机制。
-   **数据备份**: 定期对数据库进行备份，确保数据安全。

## 七、监控与维护

-   **系统健康检查**: 定期检查各微服务状态、资源使用情况。
-   **日志分析**: 持续分析系统日志，发现潜在问题。
-   **性能优化**: 根据监控数据，持续进行性能瓶颈分析和优化。
-   **Skill更新**: 随着平台策略变化，及时更新和维护抓取Skill。
-   **AI模型迭代**: 定期评估和更新AI模型，提升智能询盘和数据标签的准确性。

本方案旨在提供一个全面的技术实现蓝图，具体细节将在项目推进过程中根据实际情况进行调整和细化。
