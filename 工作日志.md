# 工作日志

## 2026年3月1日 - Search Agent 测试与 ddgs 集成

今天完成了 Scout Agent 的 Google Search 替换为 ddgs（免费），并进行了实际搜索测试。

### 1. Search Agent (Scout + ddgs) 测试成功
- **替换完成**：Scout 已从 Serper API 切换为 ddgs，无需 API Key，零配置运行。
- **包管理**：项目引入 uv 作为包管理器，依赖统一在 `pyproject.toml` 中管理。
- **Cursor 规则**：在 `.cursor/rules/uv-package-management.mdc` 中记录了 uv 的常用命令与约定。

### 2. 测试结果（能搜出的内容）

| 查询 | 返回条数 | 示例结果 |
|------|----------|----------|
| `LED lighting distributor B2B` | 10 条 | LightMart、LED Supply Co.、Golden Lighting B2B、tradewheel.com、ledlightingsupply.com… |
| `wholesale LED fixtures` | 10 条 | LED Lighting Wholesale Inc、LEDwholesalers.com、factoryleddirect.com、bulbbasics.com、superiorlighting.com… |

**注意事项**：当前 Scout 的完整查询（含 `exclude Alibaba, site:distributor OR site:wholesaler` 等）对 ddgs 过长，返回 0 条；改用简短关键词（如「关键词 + distributor / wholesale / B2B」）可正常返回结果。平台类噪音（alibaba、tradewheel 等）由 blocklist 在结果端过滤。

### 下一步计划
- **简化 Scout 查询逻辑**：为 ddgs 构建更短的查询（关键词 + distributor/wholesale/B2B），而非 Google 风格的长句，以提升返回率。
- **补充 blocklist**：考虑将 `tradewheel.com` 等 B2B 平台加入 `BLOCKED_DOMAINS`，减少噪音。
- **可选：多查询合并**：对同一关键词跑 2–3 个短查询并去重，提高线索覆盖面。

## 2026年2月28日 - 环境优化与工程化改进

今天主要进行了系统架构的重构优化、容器化配置的更新以及 Git 仓库的工程化管理。

### 1. 系统架构重构与模块化
- **后端重构**：更新了 `backend` 的目录结构与依赖管理，优化了核心业务逻辑的解耦。
- **前端更新**：同步更新了 `frontend` 的结构，并调整了依赖项，为后续线索看板的开发打下基础。
- **环境配置**：统一并优化了 `.env` 环境变量管理，确保开发与生产环境的一致性。

### 2. 容器化部署优化
- **Docker 配置更新**：重写了 `docker-compose.yml` 及相关容器配置，已解决容器间的导入路径冲突。
- **故障修复**：成功修复了 `web` (后端) 容器的 `ModuleNotFoundError` 错误。通过调整 `Dockerfile` 的目录结构、设置 `PYTHONPATH` 以及修正 `uvicorn` 启动命令，实现了对 `backend` 模块的正确识别。
- **依赖安装优化**：修正了前端 `Dockerfile` 中的依赖安装命令，解决了因缺少 `package-lock.json` 导致的部署中断问题。

### 3. Git 工程化管理
- **版本控制优化**：清理了仓库中的冗余文件，并对 Skill 模块进行了文档补充。

### 下一步计划
- 修复 `web` 容器的启动错误，恢复后端 API 服务。
- 继续推进前端看板页面的 UI 实现。

## 2026年2月26日 - B2B AI 外贸全链路自动化系统构建

昨天完成了 B2B AI 外贸系统的核心后端构建与容器化部署。系统集成了线索搜索、深度挖掘、文案生成、自动化触达及 SDR 意向分类的全流程。

### 1. 基础设施与数据库搭建
- **数据库设计**：在 PostgreSQL 中设计并实现了 `b2b_leads` 表，包含线索基础信息、审核状态、处理进度及多轮对话上下文。
- **CRUD 模块**：使用 `psycopg2` 编写了高效的数据库操作接口，支持 Docker 容器间通信与本地开发环境的无缝切换。
- **自动初始化**：在 FastAPI 启动时自动执行 SQL 脚本进行建表与索引优化。

### 2. 五大 AI Agent 模块开发
- **Scout Agent**：集成 ddgs（免费），根据产品关键词自动挖掘潜在客户官网。
- **Miner Agent**：执行网页抓取并对接 Apollo API，提取公司核心决策人的联系方式。
- **Writer Agent**：利用 Claude 3.5 Sonnet 生成个性化的破冰文案，提升转化率。
- **Outreach Agent**：集成 Instantly (Email) 与 Wati (WhatsApp) 接口，实现多渠道自动化触达，并加入“人工审核门”及随机延迟机制。
- **SDR Agent**：对客户回复进行意向分类（如：预约会议、继续跟进、黑名单），并通过飞书/推送通知实时告知。

### 3. 工作流编排与 API 实现
- **LangGraph 编排**：使用 LangGraph 状态机管理复杂的异步工作流，通过 `MemorySaver` 实现了“人工干预后继续执行”的持久化机制。
- **FastAPI 后端**：封装了 `/run_workflow`、`/approve_draft`、`/leads` 等核心接口，提供完整的 Swagger 文档支持。

### 4. 容器化部署
- **Docker 化**：编写了 `Dockerfile` 和 `.dockerignore` 优化镜像构建。
- **Docker Compose**：配置了多容器环境（Backend + PostgreSQL），实现了“一键启动”的工程化交付。

### 下一步计划
- 开始构建 **b2b-frontend-dashboard**，实现线索看板与可视化审核界面。
- 完善前端与后端 API 的链路调试。
